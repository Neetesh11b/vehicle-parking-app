<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Admin Search</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='admin_search.css') }}">
</head>
<body>

<div class="navbar">
  <div>
    <a href="{{ url_for('admin_home') }}">HOME</a> |
    <a href="{{ url_for('show_users') }}">USERS</a> |
    <a href="{{ url_for('admin_search') }}">SEARCH</a> |
    <a href="{{ url_for('admin_summary') }}">SUMMARY</a> |
    <a href="{{ url_for('logout') }}">LOGOUT</a>
  </div>
  <div>
    <a href="{{ url_for('admin_edit') }}">EDIT PROFILE</a>
  </div>
</div>

<div class="welcome">WELCOME, ADMIN SIR !</div>

<div class="container mt-4">
  <h3 class="text-center"><em>SEARCH PANEL</em></h3>
  <form method="POST" class="d-flex flex-column gap-3">
    <select name="search_type" class="form-select" required>
      <option value="" disabled selected>Search By</option>
      <option value="lot">PARKING LOT(BY ADDRESS)</option>
      <option value="user">USER ID</option>
      <option value="spot">PARKING SPOT ID(16 TO 75)</option>
    </select>
    <input type="text" name="search_query" placeholder="Enter value to search" class="form-control" required>
    <button type="submit" class="btn btn-light fw-bold">SEARCH</button>
  </form>

  {% if results %}
  <div class="results text-start">
    <h5>Search Results for "{{ query }}"</h5>

    {% if search_type == 'lot' %}
      {% for lot in results %}
        <div class="mb-3">
          <strong>Location:</strong> {{ lot.prime_locationname }}<br>
          <strong>Address:</strong> {{ lot.address }} | <strong>Pin:</strong> {{ lot.pin_code }}<br>
          <strong>Price:</strong> Rs{{ lot.price }} | <strong>Spots:</strong> {{ lot.number_of_spots }}
          <hr>
          <strong>Spots:</strong>
          <ul>
            {% for s in lot.spots %}
              <li>Spot ID: {{ s.id }} | Number: {{ s.spot_number }} | Status: {{ s.status }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endfor %}

    {% elif search_type == 'user' %}
      <div>
        <strong>User:</strong> {{ results.user.fullname }} (ID: {{ results.user.id }})<br>
        <strong>Address:</strong> {{ results.user.address }} | Pincode: {{ results.user.pincode }}
        <hr>
        {% if results.details %}
          <strong>Bookings:</strong>
          <ul>
          {% for item in results.details %}
            <li>
              Spot ID: {{ item.spot.id }} | Spot No: {{ item.spot.spot_number }} |
              Parking Lot: {{ item.lot.prime_locationname }} |
              Status: {{ item.booking.status }}
            </li>
          {% endfor %}
          </ul>
        {% else %}
          <p>No bookings found for this user.</p>
        {% endif %}
      </div>

    {% elif search_type == 'spot' %}
      <div>
        <strong>Spot ID:</strong> {{ results.spot.id }}<br>
        <strong>Spot Number:</strong> {{ results.spot.spot_number }}<br>
        <strong>Status:</strong> {{ results.spot.status }}<br>
        <strong>Parking Lot:</strong> {{ results.lot.prime_locationname }} | Address: {{ results.lot.address }}
      </div>
    {% endif %}
  </div>
  {% elif search_type %}
    <div class="alert alert-warning mt-4">No results found for "{{ query }}".</div>
  {% endif %}
</div>

</body>
</html>
